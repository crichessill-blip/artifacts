#! /bin/bash
cat > be-server.key << EOF
-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEAxLJfyaTK4olRATOVI6BQA8e7X21ryw0eEcBOzxhbMqLqiF9K
jOgf8TcrYw63xpCbW6Gd1oVt8z61n4n1+oViuOMCiMUasY/mWMZf6bM3mr2zezn1
qKATJqHM2gTj3kkvrDVw0MPBppN76BYBoCSgyruq97p88qAB9cmrtGTkqkGo/yaL
swe1RR+yeSVk8BSzkVE50EOhWweHc6nweKBLNuQwKSeJif1i+h2kncMz/DSWkyVx
5iyiw6wpfuuN08SukV7JhgnaKG1dibFp9qpdIi/ZCB/uuw/F8MKpYENbIi/yyu7Z
/yU+ZdhvHQx42X6omOls0ZECYe02OC0YSeDA1QIDAQABAoIBADrcM+zX+vyCYfKt
mG4STY9sCAac7FpVYQ+n0A2J+NR0yyEm/tyeo9xfiYS5hUYOxObNPLnSsN3PALOu
qaSfoLS5/eqmrP/Ak4oyRsZc4oFUTi7MX9ZnnIN9fJsrRnMgzHrIfSuDwOHTlYsU
dsUQ4Or58MX0EOrb9eoywMaZQJIv0JB+lxv3hHvV1YiHFzkoWXJfhUFLB+Qbfvnm
SlYVS7aCXO6YWbyrTiaLknBilTwjJr/ZytpBV5vdEh4xiGFLGsYrawT/jk+20qo/
Bz3VYjaH+hhqe59eMSBDj9JiWLQ3vnLI87kltTSs9LumB/yYrov0XaS34aCSKxs2
7q4vWysCgYEA3yvPSXUtrm7OHOXIrNt1KlNT8b8vZ2AsMXCNu40Dse9lAkS5cJvc
DgcBQ37OLcV1JvJseH3SUjQRA0lz0D9ZKe6Zp11pXwT+IOTpS0eIGZmGI/MjR5wf
t8hqjFWNKsCwrXpwZTulafCTafsLBbiWNTKk91/sk4iEXIZ+T+zmepMCgYEA4aGX
eXNvVYNQPdF9L8Cds2H3JrRItLiFIQ/NIbUIdNzFFPXmCSXvAz/UjWYwrXCxrddR
jFaDNpnsLEgm5htZLvmI2ysAa7FJLkiqrX3u7hfERQtsli3km37jCpq5EprV6wx0
HG3MC4oEIci3QGGSu5B4gjI298Mfjw4pBIMyr/cCgYBW44u1IfZDL8j3308eXeNk
M0U/nhwqt3r9VMEaAHEr2fUNyQwaF9S5cWjAiqJjl7lhDInG79XvQ25MRVDeB4wD
k24nh2r7H8qBrB5YvOT0cp2TaZqWyuZee51gPf7UYmlnYYBZKbvhX1VFsgQ8mf2B
gNJRrftCBajjDUoofCfQGQKBgQCGMLXG3JmNcSCK84mRmevwoMX99eD74nYC+MPW
VTWnUxm/YpOiQzZIZ3EBe5JdxJVXv6RXY6h8E8U7fNntprw+zNfRCV0hr3nHlh40
Op6cafQn4Ch/lOHOfQOI7gY+A2pQdcKkmcRt5HKaqSYbmyxKcxzIyhaY+ipNyW0p
quG9dwKBgHXnBU3RPjP8d03NqfIfyx3ugdLeR1t3OCN6u7bMNY+3ameRgj2tdyx8
CNoUqS36L5ozkrIBXniuNUzHicwZ39H2fT7SPX4svffa7KErIESlTX8YSMzYbJGG
+xUizkwms1wfAHaDlwD3Ld6FasqxX2DqMUamFqKgHLncYH7GVXGn
-----END RSA PRIVATE KEY-----
EOF

cat > be-server.cert << EOF
-----BEGIN CERTIFICATE-----
MIIEojCCAoqgAwIBAgIQYs0cegDJ8HwdcUfBpN49jTANBgkqhkiG9w0BAQsFADA1
MRswGQYDVQQKExJiZS1hcGFjaGUtcm9vdC1vcmcxFjAUBgNVBAMTDWJlLWFwYWNo
ZS1pbnQwHhcNMjUwNTI4MTkzNDU2WhcNMjYwNTI4MTkzNDU2WjBMMRAwDgYDVQQK
EwdleGFtcGxlMRcwFQYDVQQLEw5neGxiLXRvLWFwYWNoZTEfMB0GA1UEAxMWZXhh
bXBsZWJhY2tlZW5kc3ZjLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoC
ggEBAMSyX8mkyuKJUQEzlSOgUAPHu19ta8sNHhHATs8YWzKi6ohfSozoH/E3K2MO
t8aQm1uhndaFbfM+tZ+J9fqFYrjjAojFGrGP5ljGX+mzN5q9s3s59aigEyahzNoE
495JL6w1cNDDwaaTe+gWAaAkoMq7qve6fPKgAfXJq7Rk5KpBqP8mi7MHtUUfsnkl
ZPAUs5FROdBDoVsHh3Op8HigSzbkMCkniYn9YvodpJ3DM/w0lpMlceYsosOsKX7r
jdPErpFeyYYJ2ihtXYmxafaqXSIv2Qgf7rsPxfDCqWBDWyIv8sru2f8lPmXYbx0M
eNl+qJjpbNGRAmHtNjgtGEngwNUCAwEAAaOBljCBkzAOBgNVHQ8BAf8EBAMCBeAw
EwYDVR0lBAwwCgYIKwYBBQUHAwEwDAYDVR0TAQH/BAIwADAfBgNVHSMEGDAWgBQA
uLHgfSFOBThilP2W1ozErmJEnDA9BgNVHREENjA0ghZleGFtcGxlYmFja2VlbmRz
dmMuY29tghphcGkuZXhhbXBsZWJhY2tlZW5kc3ZjLmNvbTANBgkqhkiG9w0BAQsF
AAOCAgEAHg25kGdbtp09a77KUWjlPsCGQ/vW3Ffq1zgO0ZAgBtu0cbsvSPBR4cQy
h+0/C234g/pCOrw8izKWgcBNdqQmQx5QDIxyR/09rpPvChcWsrk31WInpat0WVXr
cbYyOssXKuuzln5dacVY/FhrvWm7BEBY8LpiDKGtRCoahCgc7S9XuwMtFwe7HtGB
/aL3oUsZlKEtW6zHXfiCMjcBjuQbqUgXoMhS4fLYQ+JM4ypEpeyk3BrwVqWmdNWM
JwDZHNA8rI6EuUsw1jyFVvGXFYg/fFoiFQa+bM7FLAWfrfp/9tU/ZPW9tDE8jYPe
lMCuMq+uS+EossylJ2J7Kv858acwuOzHt0cPmSCCFXmvGc6dJgiHUtnUflN2aE6o
6AuDY41z7stqH9MZq61heXMgnDUMcbQF0SBsK3nCNh2uYMzjjXFaa/juqH9J2Q1p
UVusqBD9c4P7Rwhc38QH8VoLtkurPoIgpqLcuLF18huRV1z+w3hzHRjXvKAFUlya
pLpDINhh4XN9Kx+bR706YLQSwfW6cVsOoVeHH/iWrWdkRKPoR7/PYRBCQZOeyUe8
BPGHN5vCtOE/UY8O4Uli3rYIw9YLaO4RuRMXo6w1bR289c3974O9KXEEntKJcmBq
DOwGxorGNhWP/Tt12I/AgW6xdokd+M+ph5bg1Q6VEz7rZ5uZ5WY=
-----END CERTIFICATE-----
EOF


sudo cp ./be-server.key /etc/ssl/private/be-server.key
sudo cp ./be-server.cert /etc/ssl/certs/be-server.cert

cat > lb-root.cert << EOF
-----BEGIN CERTIFICATE-----
MIIFFTCCAv2gAwIBAgIQWXYBHTj0u/PpeHWumB+RKjANBgkqhkiG9w0BAQsFADAZ
MRcwFQYDVQQDEw5iZS1jbGllbnQtcm9vdDAgFw0yNTA1MjgxOTM0NTdaGA8yMTI1
MDUwNDE5MzQ1N1owGTEXMBUGA1UEAxMOYmUtY2xpZW50LXJvb3QwggIiMA0GCSqG
SIb3DQEBAQUAA4ICDwAwggIKAoICAQDBQcI21CXnS+mgGbDQYxnlJa3z7HNvcrpI
Z+4gVg2eOTCBZ5tfccTlvgBd0hbaykogLSm5IjuGAyV6MOXtsXkvXUb3GrdwO9eB
yumGuvlqLxmQ34kihmx5FHVPvaJvZxvVgEA7eoupomN6Dr2htU1WMc56nD6kQyjL
8425V9l16T3AGfhxWY9WnX4x9KOgC7fAA1PYcBrrLlQFlko5NhoqOgnZEryWvGlZ
qrjhTQmkokIgSsNTI/WrMXTXzKsEsUA1sm6FWa36viX786bR/D6/PpLcGHIMciFL
MQqXKuh/TVGdBx06OkSOi1bENyV241fIy2MymFv7Y2nLTqt0JKS3GgpToTrb8M1M
gtMyFxtoKGjXI6vB3LqLM2fVliKRq/Saem5s033d8lXoSBKRz77mPR5dAEvbkCp5
YAP/TiaTeDzEUNAfACADLynj89AGJ1bFVvIjXxjvKi/JogwMXm7UVXfbrfGDZqhS
l0Rru2dOnwiE+uLl6904B88DXBk89dE2DbzpCNtMiIWWsDGMaj2oXHOU4rAH053c
p1ZnlFL2ohL96sFT6svHxl6lR6ld3XpFTcWrGC0ux3148jOxCc8gNCcRDclFbxwK
JGju+dYip5MVBah4lGyZoc/PoxitULqMFrU91ZgjGvlqCmT1bxpNwViH2P1g6JIj
RBZyGmjFgQIDAQABo1cwVTAOBgNVHQ8BAf8EBAMCAgQwEwYDVR0lBAwwCgYIKwYB
BQUHAwIwDwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQUH0gdAmBHqiZzyFs8Onu3
qep3DDcwDQYJKoZIhvcNAQELBQADggIBAHTwCJ6UMMkaQ6wgz0By8PuBKN3JbE6w
gm3eMSxXvCoHnFOeqqfypgKttMm0xtQt/RL9i8sH2oGoDzwLC/cFiDc7pajVD4jk
l8T8PABNekZO0WOLwWMiWe8qlpMAs46O0f48XwEBtm0wI/5wUhUiSXhfFRrONzkl
rpQGt5ZB14CVrn4Znqk0hJSUMpA4Yv9jw2Nq+/hI1AydF60G5rtBlNH6LC8eHsGF
n2z/ehMd8MQhYVRzORcGnuYcnJxfk7MMGTEY0VQl84cZjHjNDPibYTcsGL4ysIHE
04Qax4PR/A482firm/N6P43OfAI43V2OiayGSTlc+zDKgUeLZbAfpWg3Va48dRDV
wK7vxklwezwasneAm0KN5QwBy2hdy69lc1SqWDAEKIn5GMJZi5zdlN58AaB//oIO
BQ5kC7lGGwlQre8WaJyz34xSeDsCz8aIDm0i/FszwSqO8allIk1oO19mfHei52Od
MLamn4wTj4W7Zxv2rJ+NSN4qvDQB5BssHEtQwXMfymGLyAzr9XTSeqpAXYk0QxFg
csGsbI7fhXnfBanBlGE2u02YIsHBbiLioofjmtli6UQdVkidk1rgXBH/SPS8EvpH
fnMSWN1rBfntF1dYYlBEll/Y9S/oc2cmOe6id+7ZZLIkSX3OokrlZEqF3S8dX7DP
n8sd8ir7SivU
-----END CERTIFICATE-----
EOF


sudo cp ./lb-root.cert /etc/ssl/certs/lb-root.cert
sudo tee -a /etc/apache2/sites-available/default-ssl.conf > /dev/null <<EOF

# Server certificate and key
SSLCertificateFile      /etc/ssl/certs/be-server.cert
SSLCertificateKeyFile   /etc/ssl/private/be-server.key
SSLOptions +StdEnvVars +ExportCertData

# Client certificate verification
SSLVerifyClient require
LogLevel ssl:debug
SSLVerifyDepth 5
SSLCACertificateFile /etc/ssl/certs/lb-root.cert
EOF
sudo c_rehash /etc/ssl/certs/
sudo systemctl restart apache2.service